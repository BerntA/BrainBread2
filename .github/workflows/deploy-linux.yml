name: Deploy on Linux

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
    
    - name: C/C++ dev tools
      run: |
        sudo apt update
        sudo apt-get install build-essential gcc-multilib g++-multilib
      
    - name: Setup Steam Runtime
      run: |
        sudo wget https://media.steampowered.com/client/runtime/steam-runtime-sdk_latest.tar.xz
        sudo tar xvf steam-runtime-sdk_latest.tar.xz
        sudo mv steam-runtime-sdk_2013-09-05 runtime
        sudo ./runtime/setup.sh --auto-update --target=i386 --release
    
    - name: Create makefile
      run: sudo ./creategameprojects
      
    - name: Show Contents
      run: |
        ls -la
        cd runtime
        ls -la
      
    - name: Build
      run: |
        sudo ./runtime/shell-i386.sh
        sudo make -f brainbread.mak

    - name: Upload Binaries
      uses: actions/upload-artifact@v2
      with:
        name: Linux Binaries
        path: game/build/*.so
